import unittest
from tweepy.models import Status
from json import load
from copy import deepcopy
from TwitterWatcher.tools.preprocessing import Preprocessing

class TwitterWatcherPreprocessingTests(unittest.TestCase):

		def setUp(self):
				def load_status():
						with open('./tests/cassettes/sample-tweet.json') as infile:
								status = Status.parse(api=None, json=load(infile))
								return status

				self._status = Status.parse(
						api=None,
						json={'created_at': 'Fri Dec 01 01:53:45 +0000 2017', 'id': 936412976520876032, 'id_str': '936412976520876032', 'text': '@realDonaldTrump https://t.co/0BW86RBIRH', 'display_text_range': [17, 40], 'source': '<a href="http://twitter.com/download/iphone" rel="nofollow">Twitter for iPhone</a>', 'truncated': False, 'in_reply_to_status_id': 936395008139198464, 'in_reply_to_status_id_str': '936395008139198464', 'in_reply_to_user_id': 25073877, 'in_reply_to_user_id_str': '25073877', 'in_reply_to_screen_name': 'realDonaldTrump', 'user': {'id': 29363354, 'id_str': '29363354', 'name': 'Kate', 'screen_name': 'k8_doo', 'location': 'United States', 'url': None, 'description': 'Follow me if you want to know how far I walked, hiked or ran today for #charitymiles', 'translator_type': 'none', 'protected': False, 'verified': False, 'followers_count': 322, 'friends_count': 943, 'listed_count': 3, 'favourites_count': 26916, 'statuses_count': 3334, 'created_at': 'Tue Apr 07 02:56:52 +0000 2009', 'utc_offset': -18000, 'time_zone': 'Eastern Time (US & Canada)', 'geo_enabled': True, 'lang': 'en', 'contributors_enabled': False, 'is_translator': False, 'profile_background_color': 'EBEBEB', 'profile_background_image_url': 'http://abs.twimg.com/images/themes/theme7/bg.gif', 'profile_background_image_url_https': 'https://abs.twimg.com/images/themes/theme7/bg.gif', 'profile_background_tile': False, 'profile_link_color': '990000', 'profile_sidebar_border_color': 'DFDFDF', 'profile_sidebar_fill_color': 'F3F3F3', 'profile_text_color': '333333', 'profile_use_background_image': True, 'profile_image_url': 'http://pbs.twimg.com/profile_images/823305825297006593/LhjPdILK_normal.jpg', 'profile_image_url_https': 'https://pbs.twimg.com/profile_images/823305825297006593/LhjPdILK_normal.jpg', 'profile_banner_url': 'https://pbs.twimg.com/profile_banners/29363354/1485126381', 'default_profile': False, 'default_profile_image': False, 'following': None, 'follow_request_sent': None, 'notifications': None}, 'geo': None, 'coordinates': None, 'place': {'bounding_box': {'coordinates': [[1, 2], [3, 2, 1]]}}, 'contributors': None, 'quoted_status_id': 936379603651883008, 'quoted_status_id_str': '936379603651883008', 'quoted_status': {'created_at': 'Thu Nov 30 23:41:09 +0000 2017', 'id': 936379603651883008, 'id_str': '936379603651883008', 'text': 'On the left: @BarackObama’s National Tree Lighting\nOn the right: @realDonaldTrump’s National Tree Lighting… https://t.co/PcsatAL7Lu', 'display_text_range': [0, 140], 'source': '<a href="http://twitter.com/download/iphone" rel="nofollow">Twitter for iPhone</a>', 'truncated': True, 'in_reply_to_status_id': None, 'in_reply_to_status_id_str': None, 'in_reply_to_user_id': None, 'in_reply_to_user_id_str': None, 'in_reply_to_screen_name': None, 'user': {'id': 329433192, 'id_str': '329433192', 'name': 'Jeremy Dickey', 'screen_name': 'JeremyDDickey', 'location': 'Washington, D.C.', 'url': 'https://medium.com/@JeremyDDickey', 'description': 'City Government Media Specialist. Aspiring CJ Cregg. Graduate of @MercyhurstU & @LCCLondon. RTs = you got my attention. Tweets are my own. Sarcasm also my own.', 'translator_type': 'none', 'protected': False, 'verified': False, 'followers_count': 1860, 'friends_count': 2452, 'listed_count': 129, 'favourites_count': 5864, 'statuses_count': 64253, 'created_at': 'Tue Jul 05 02:20:11 +0000 2011', 'utc_offset': -18000, 'time_zone': 'Eastern Time (US & Canada)', 'geo_enabled': True, 'lang': 'en', 'contributors_enabled': False, 'is_translator': False, 'profile_background_color': '1A1B1F', 'profile_background_image_url': 'http://pbs.twimg.com/profile_background_images/474534472373649408/gaee5mbF.png', 'profile_background_image_url_https': 'https://pbs.twimg.com/profile_background_images/474534472373649408/gaee5mbF.png', 'profile_background_tile': False, 'profile_link_color': '3B94D9', 'profile_sidebar_border_color': 'FFFFFF', 'profile_sidebar_fill_color': '252429', 'profile_text_color': '666666', 'profile_use_background_image': False, 'profile_image_url': 'http://pbs.twimg.com/profile_images/932429063280627713/HnHFID4p_normal.jpg', 'profile_image_url_https': 'https://pbs.twimg.com/profile_images/932429063280627713/HnHFID4p_normal.jpg', 'profile_banner_url': 'https://pbs.twimg.com/profile_banners/329433192/1443752276', 'default_profile': False, 'default_profile_image': False, 'following': None, 'follow_request_sent': None, 'notifications': None}, 'geo': None, 'coordinates': None, 'place': {'id': '6417871953fa5e86', 'url': 'https://api.twitter.com/1.1/geo/id/6417871953fa5e86.json', 'place_type': 'city', 'name': 'Silver Spring', 'full_name': 'Silver Spring, MD', 'country_code': 'US', 'country': 'United States', 'bounding_box': {'type': 'Polygon', 'coordinates': [[[-77.064086, 38.979735], [-77.064086, 39.036964], [-76.97162, 39.036964], [-76.97162, 38.979735]]]}, 'attributes': {}}, 'contributors': None, 'is_quote_status': False, 'extended_tweet': {'full_text': 'On the left: @BarackObama’s National Tree Lighting\nOn the right: @realDonaldTrump’s National Tree Lighting #Christmas https://t.co/wYoLJRO2r6', 'display_text_range': [0, 117], 'entities': {'hashtags': [{'text': 'Christmas', 'indices': [107, 117]}], 'urls': [], 'user_mentions': [{'screen_name': 'BarackObama', 'name': 'Barack Obama', 'id': 813286, 'id_str': '813286', 'indices': [13, 25]}, {'screen_name': 'realDonaldTrump', 'name': 'Donald J. Trump', 'id': 25073877, 'id_str': '25073877', 'indices': [65, 81]}], 'symbols': [], 'media': [{'id': 936379576682450944, 'id_str': '936379576682450944', 'indices': [118, 141], 'media_url': 'http://pbs.twimg.com/media/DP6wQ4sWkAAvTDD.jpg', 'media_url_https': 'https://pbs.twimg.com/media/DP6wQ4sWkAAvTDD.jpg', 'url': 'https://t.co/wYoLJRO2r6', 'display_url': 'pic.twitter.com/wYoLJRO2r6', 'expanded_url': 'https://twitter.com/JeremyDDickey/status/936379603651883008/photo/1', 'type': 'photo', 'sizes': {'medium': {'w': 1200, 'h': 800, 'resize': 'fit'}, 'small': {'w': 680, 'h': 453, 'resize': 'fit'}, 'thumb': {'w': 150, 'h': 150, 'resize': 'crop'}, 'large': {'w': 1752, 'h': 1168, 'resize': 'fit'}}}, {'id': 936379575839358977, 'id_str': '936379575839358977', 'indices': [118, 141], 'media_url': 'http://pbs.twimg.com/media/DP6wQ1jWAAE7CdA.jpg', 'media_url_https': 'https://pbs.twimg.com/media/DP6wQ1jWAAE7CdA.jpg', 'url': 'https://t.co/wYoLJRO2r6', 'display_url': 'pic.twitter.com/wYoLJRO2r6', 'expanded_url': 'https://twitter.com/JeremyDDickey/status/936379603651883008/photo/1', 'type': 'photo', 'sizes': {'small': {'w': 680, 'h': 680, 'resize': 'fit'}, 'thumb': {'w': 150, 'h': 150, 'resize': 'crop'}, 'medium': {'w': 1200, 'h': 1200, 'resize': 'fit'}, 'large': {'w': 2048, 'h': 2048, 'resize': 'fit'}}}]}, 'extended_entities': {'media': [{'id': 936379576682450944, 'id_str': '936379576682450944', 'indices': [118, 141], 'media_url': 'http://pbs.twimg.com/media/DP6wQ4sWkAAvTDD.jpg', 'media_url_https': 'https://pbs.twimg.com/media/DP6wQ4sWkAAvTDD.jpg', 'url': 'https://t.co/wYoLJRO2r6', 'display_url': 'pic.twitter.com/wYoLJRO2r6', 'expanded_url': 'https://twitter.com/JeremyDDickey/status/936379603651883008/photo/1', 'type': 'photo', 'sizes': {'medium': {'w': 1200, 'h': 800, 'resize': 'fit'}, 'small': {'w': 680, 'h': 453, 'resize': 'fit'}, 'thumb': {'w': 150, 'h': 150, 'resize': 'crop'}, 'large': {'w': 1752, 'h': 1168, 'resize': 'fit'}}}, {'id': 936379575839358977, 'id_str': '936379575839358977', 'indices': [118, 141], 'media_url': 'http://pbs.twimg.com/media/DP6wQ1jWAAE7CdA.jpg', 'media_url_https': 'https://pbs.twimg.com/media/DP6wQ1jWAAE7CdA.jpg', 'url': 'https://t.co/wYoLJRO2r6', 'display_url': 'pic.twitter.com/wYoLJRO2r6', 'expanded_url': 'https://twitter.com/JeremyDDickey/status/936379603651883008/photo/1', 'type': 'photo', 'sizes': {'small': {'w': 680, 'h': 680, 'resize': 'fit'}, 'thumb': {'w': 150, 'h': 150, 'resize': 'crop'}, 'medium': {'w': 1200, 'h': 1200, 'resize': 'fit'}, 'large': {'w': 2048, 'h': 2048, 'resize': 'fit'}}}]}}, 'quote_count': 56, 'reply_count': 44, 'retweet_count': 326, 'favorite_count': 385, 'entities': {'hashtags': [], 'urls': [{'url': 'https://t.co/PcsatAL7Lu', 'expanded_url': 'https://twitter.com/i/web/status/936379603651883008', 'display_url': 'twitter.com/i/web/status/9…', 'indices': [108, 131]}], 'user_mentions': [{'screen_name': 'BarackObama', 'name': 'Barack Obama', 'id': 813286, 'id_str': '813286', 'indices': [13, 25]}, {'screen_name': 'realDonaldTrump', 'name': 'Donald J. Trump', 'id': 25073877, 'id_str': '25073877', 'indices': [65, 81]}], 'symbols': []}, 'favorited': False, 'retweeted': False, 'possibly_sensitive': False, 'filter_level': 'low', 'lang': 'en'}, 'is_quote_status': True, 'quote_count': 0, 'reply_count': 0, 'retweet_count': 0, 'favorite_count': 0, 'entities': {'hashtags': [], 'urls': [{'url': 'https://t.co/0BW86RBIRH', 'expanded_url': 'https://twitter.com/jeremyddickey/status/936379603651883008', 'display_url': 'twitter.com/jeremyddickey/…', 'indices': [17, 40]}], 'user_mentions': [{'screen_name': 'realDonaldTrump', 'name': 'Donald J. Trump', 'id': 25073877, 'id_str': '25073877', 'indices': [0, 16]}], 'symbols': []}, 'favorited': False, 'retweeted': False, 'possibly_sensitive': False, 'filter_level': 'low', 'lang': 'und', 'timestamp_ms': '1512093225971'}
				)

				self._status_backup = deepcopy(self._status)

		def test_clean_status(self):
				cleaned_status: Status = Preprocessing.compress_status(tweet=self._status)
				self.assertEqual(cleaned_status.user.id, self._status_backup.user.id)

		def test_coordinates_array(self):
				cleaned_status: Status = Preprocessing.compress_status(tweet=self._status)
				self.assertIsInstance(cleaned_status._json['quoted_status']['place']['bounding_box']['coordinates'], str)
				cleaned_status: Status = Preprocessing.compress_status(tweet=self._status)
				self.assertIsInstance(cleaned_status._json['place']['bounding_box']['coordinates'], str)
